<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>海马商城-用户中心</title>
    <link rel="stylesheet" type="text/css" href="../static/CSS/reset.css">
    <link rel="stylesheet" type="text/css" href="../static/CSS/main.css">
    <script type="text/javascript" src="../static/JS/jquery-3.3.1.min.js"></script>
</head>
<body>
{% include 'home_head.html' %}
<div class="search_bar clearfix">
    <a href="/haima/" class="logo fl"><img src="../static/Images/haima3.png" width="200" height="100"></a>
    <div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;个人信息</div>
</div>

<div class="main_con clearfix">
    <div class="left_menu_con clearfix">
        <h3>用户中心</h3>
        <ul>
            <li><a href="/user_center/">· 个人信息</a></li>
            <li><a href="/my_sale/">· 我出售的</a></li>
            <li><a href="/my_buy/">· 我购买的</a></li>
            <li><a href="user_center_order.html">· 我的拍卖</a></li>
            <li><a href="/my_collection/">· 我的收藏</a></li>
            <li><a href="/my_evaluate_get/">· 我的评价</a></li>
            <li><a href="/leave_message/">· 宝贝留言</a></li>
            <li><a href="/modify_information/">· 修改信息</a></li>
            <li><a href="/modify_password/" class="active">· 修改密码</a></li>
        </ul>
    </div>
    <div class="right_content clearfix" style="border-bottom: 1px solid #e2e2e2">
        <h3 class="common_title2" style="border-bottom: 1px solid #e2e2e2;text-align: center">修改密码</h3>
        <div id="modify_message">
            {#            <form action="">#}
            {##}
            {#                <div><input type="submit" value="保存" id="save"></div>#}
            {#            </form>#}
            <div style="margin-left: 200px">
                <div id="mod_psw_prcs" class="clearfix">
                    <ul>
                        <li id="active_mod"></li>
                        <li class="mod_li_2"></li>
                        <li class="mod_li_3"></li>
                    </ul>
                </div>

                <div id="mod_psw_word" class="clearfix">
                    <ul>
                        <li id="active_word">1.验证手机号</li>
                        <li class="mod_word_2">2.修改密码</li>
                        <li class="mod_word_3">3.修改完成</li>
                    </ul>
                </div>
                <div style="margin-left: 280px;margin-bottom: 20px;margin-top: 10px">
                    <div class="mod_prcs_1">
                        <ul style="position: relative;left: -200px">
                            <li class="clearfix">
                                <div style="margin-top: 3px">手&nbsp;&nbsp;机&nbsp;&nbsp;号&nbsp;&nbsp;码&nbsp;：</div>
                                <div>
                                    <input type="text" id="user_phone"
                                           style="height: 25px;width: 200px;margin-left: -1px">
                                </div>
                                <div id="phone_error" style="color: red;margin-left: 10px;line-height: 24px">

                                </div>
                            </li>
                            <li class="clearfix">
                                <div style="margin-top: 3px">手&nbsp;机&nbsp;验&nbsp;证&nbsp;码：</div>
                                <div>
                                    <input type="text" id="phone_yzm"
                                           style="height: 25px;width: 120px;margin-left: -2px">
                                </div>
                                <div>
                                    <input type="button" value="获取验证码"
                                           style="height: 28px;width: 76px;margin-left: 5px;" id="mod_yzm">
                                </div>
                                <div id="yzm_error" style="color: red;margin-left: 10px;line-height: 24px">

                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="mod_prcs_2" style="display: none">
                        <ul style="position: relative;left: -200px">
                            <li class="clearfix">
                                <div style="margin-top: 3px">登&nbsp;&nbsp;录&nbsp;&nbsp;密&nbsp;&nbsp;码&nbsp;：</div>
                                <div>
                                    <input type="text" id="pwd" style="height: 25px;width: 200px;margin-left: -1px">
                                </div>
                                <div id="user_password_none" style="color: red;margin-left: 10px;line-height: 24px">

                                </div>
                            </li>
                            <li class="clearfix">
                                <div style="margin-top: 3px">确认登录密码：</div>
                                <div>
                                    <input type="text" id="repwd" style="height: 25px;width: 200px">
                                </div>
                                <div id="repsd_error" style="color: red;margin-left: 10px;line-height: 24px">

                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="mod_prcs_3" style="display: none;font-size: 20px;font-weight: bold;margin-top: 20px;margin-bottom: -10px">修改成功!</div>
                </div>
            </div>
            <div align="center">
                <button id="modify_button">确定</button>
            </div>
        </div>
    </div>
</div>


<div class="footer">
    <div class="foot_link">
        <a href="#">关于我们</a>
        <span>|</span>
        <a href="#">联系我们</a>
        <span>|</span>
        <a href="#">招聘人才</a>
        <span>|</span>
        <a href="#">友情链接</a>
    </div>
    <p>CopyRight © 2018 苏州海马商业股份有限公司 All Rights Reserved</p>
    <p>电话：0512-****888 苏ICP备*******8号</p>
</div>
<script type="text/javascript" src="../static/JS/main.js"></script>
</body>
<script>
    //验证手机号
    function checkPhone() {
        var phone = document.getElementById('user_phone');
        var pattern = /^1[34578]\d{9}$/; //验证手机号正则表达式
        if (!pattern.test(phone.value)) {
            document.getElementById('phone_error').innerText = '您输入的手机号格式不正确';
            document.getElementById('phone_error').style.color = 'Red';
            document.getElementById('phone_error').style.display = 'block';
            return false;
        }
        else {
            document.getElementById('phone_error').style.display = 'none';
            return true;
        }
    }
</script>
<script>
    $(document).ready(function () {
        $("#active_mod").css('background-color', '#ffda44')
        $("#active_word").css('color', '#ffba3b')
    });

    var i = 1;
    $("#modify_button").click(function () {
        user_phone = $("#user_phone").val();
        user_password = $("#pwd").val();
        phone_yzm = $("#phone_yzm").val();
        repwd = $("#repwd").val();
        $.post(/modify_password_ajax/, {
            'user_phone': user_phone,
            'user_password': user_password,
            'phone_yzm': phone_yzm,
            'repwd': repwd,
        }, function (data) {
            if (data.msg == 'phone_error') {
                $("#phone_error").html("请正确填写注册时的手机号码")
            }
            else if (data.msg == 'phone_yzm_error') {
                $("#yzm_error").html("验证码错误")
            }
            else if (data.msg == 'user_password_none') {
                $("#user_password_none").html("密码不能为空")
            }
            else if (data.msg == 'repsd_error') {
                $("#repsd_error").html("两次密码不一致")
            }
            else {
                i++;
                $("#user_phone").val('');
                $("#phone_yzm").val('');
                $(".mod_li_" + i).css('background-color', '#ffda44');
                $(".mod_word_" + i).css('color', '#ffba3b');
                $("[class^=mod_prcs_]").css('display', 'none');
                $(".mod_prcs_" + i).css('display', 'block');
                if (i == 3) {
                    $("#modify_button").css('display', 'none')
                }
            }
        }, 'json')
    });

    var check = 'false'
    $("#user_phone").blur(function () {
        user_phone = $("#user_phone").val();
        if (user_phone) {
            if (checkPhone()) {
                $.post(/modify_password_ajax/, {
                    'user_phone': user_phone,
                }, function (data) {
                    if (data.msg == 'phone_error') {
                        $("#phone_error").show();
                        $("#phone_error").html("请正确填写注册时的手机号码")
                    }
                    else {
                        check = 'ture'
                    }
                }, 'json');
            }
        }
    });


    $("#mod_yzm").click(function () {
        if (check === 'ture') {
            phone = $("#user_phone").val();
            $.ajax({
                type: "POST",
                url: "/send_sms/",
                data: {phone: phone},
                dataType: "json",
                success: function (data) {
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                },
            })
        }
    })

</script>

</html>
